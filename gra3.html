<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>Gra 2 Graczy</title>
<style>
html,body{margin:0;height:100%;background:#0f1720;color:#fff;font-family:sans-serif;overflow:hidden}
canvas{width:100%;height:100%;display:block;background:#5aa;}
.overlay{position:absolute;inset:0;pointer-events:none}
.side{position:absolute;top:0;bottom:0;width:50%;pointer-events:auto}
.left{left:0}.right{right:0}
.hud{position:absolute;top:4px;left:4px;background:rgba(0,0,0,0.45);padding:4px 6px;border-radius:6px;font-size:12px}
.hud.right{left:auto;right:4px}
.controls{position:absolute;display:grid;grid-template-columns:repeat(3,50px);grid-template-rows:repeat(2,50px);gap:6px;bottom:8px}
.controls.left{left:4px}.controls.right{right:4px}
.btn{width:50px;height:50px;border-radius:10px;background:rgba(0,0,0,0.45);display:flex;align-items:center;justify-content:center;font-size:20px;touch-action:none;user-select:none}
.centerPanel{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:auto}
.panel{background:#111827;padding:8px;border-radius:10px;max-width:95%;box-shadow:0 4px 12px rgba(0,0,0,0.6);font-size:12px}
.selectionRow{display:flex;gap:6px;justify-content:center;flex-wrap:nowrap;overflow-x:auto;padding:4px 0}
.card{background:rgba(255,255,255,0.03);padding:6px;border-radius:8px;min-width:60px;text-align:center;cursor:pointer;border:2px solid transparent;font-size:14px}
.card.selected{border-color:#06b6d4}
.mapPreview{height:40px;width:70px;border-radius:6px}
.startBtn{margin-top:6px;padding:6px 10px;background:#06b6d4;border:none;border-radius:6px;color:#000;font-weight:600;cursor:pointer;font-size:14px}
</style>
</head>
<body>
<canvas id="game"></canvas>
<div class="overlay">
  <div class="side left">
    <div class="hud" id="hud1">Gracz 1 ‚Äî HP: <span id="hp1">0</span></div>
    <div class="controls left">
      <div class="btn" id="p1-up">‚ñ≤</div><div></div><div></div>
      <div class="btn" id="p1-left">‚óÄ</div><div></div><div class="btn" id="p1-right">‚ñ∂</div>
    </div>
  </div>
  <div class="side right">
    <div class="hud right" id="hud2">Gracz 2 ‚Äî HP: <span id="hp2">0</span></div>
    <div class="controls right">
      <div class="btn" id="p2-up">‚ñ≤</div><div></div><div></div>
      <div class="btn" id="p2-left">‚óÄ</div><div></div><div class="btn" id="p2-right">‚ñ∂</div>
    </div>
  </div>
  <div class="centerPanel" id="startPanel">
    <div class="panel">
      <h3>Wybierz bro≈Ñ i mapƒô</h3>
      <div style="display:flex;gap:12px;flex-wrap:wrap;justify-content:center">
        <div><h4>Gracz 1</h4>
          <div class="selectionRow" id="g1-weapons">
            <div class="card" data-player="0" data-weapon="sword">üó°Ô∏è<div>Miecz</div></div>
            <div class="card" data-player="0" data-weapon="bow">üèπ<div>≈Åuk</div></div>
            <div class="card" data-player="0" data-weapon="flail">‚ö™<div>Kula</div></div>
          </div>
        </div>
        <div><h4>Gracz 2</h4>
          <div class="selectionRow" id="g2-weapons">
            <div class="card" data-player="1" data-weapon="sword">üó°Ô∏è<div>Miecz</div></div>
            <div class="card" data-player="1" data-weapon="bow">üèπ<div>≈Åuk</div></div>
            <div class="card" data-player="1" data-weapon="flail">‚ö™<div>Kula</div></div>
          </div>
        </div>
      </div>
      <h4>Mapa</h4>
      <div class="selectionRow" id="maps">
        <div class="card" data-map="1"><div class="mapPreview map1"></div><div>P≈Çaska</div></div>
        <div class="card" data-map="2"><div class="mapPreview map2"></div><div>Wyspy</div></div>
        <div class="card" data-map="3"><div class="mapPreview map3"></div><div>Pude≈Çko</div></div>
      </div>
      <button class="startBtn" id="startBtn">Start!</button>
    </div>
  </div>
</div>
<script>
let canvas=document.getElementById("game"),ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;canvas.height=window.innerHeight;
let weapons=[null,null],mapChoice=null,players=[],projectiles=[],gameRunning=false;

function initSelections(){
  document.querySelectorAll(".card[data-weapon]").forEach(c=>{
    c.onclick=()=>{let p=+c.dataset.player;weapons[p]=c.dataset.weapon;
      document.querySelectorAll(`.card[data-player='${p}']`).forEach(cc=>cc.classList.remove("selected"));
      c.classList.add("selected");};
  });
  document.querySelectorAll(".card[data-map]").forEach(c=>{
    c.onclick=()=>{mapChoice=c.dataset.map;
      document.querySelectorAll(".card[data-map]").forEach(cc=>cc.classList.remove("selected"));
      c.classList.add("selected");};
  });
  document.getElementById("startBtn").onclick=startGame;
}initSelections();

// kontrolki
let controls={};
["p1-left","p1-right","p1-up","p2-left","p2-right","p2-up"].forEach(id=>{
  let el=document.getElementById(id);
  ["touchstart","mousedown"].forEach(ev=>el.addEventListener(ev,e=>{controls[id]=true;e.preventDefault()}));
  ["touchend","mouseup","mouseleave"].forEach(ev=>el.addEventListener(ev,e=>{controls[id]=false;e.preventDefault()}));
});

// HP
function weaponHP(w){if(w==="flail")return 12;if(w==="bow")return 11;return 9}

// start gry
function startGame(){
  if(!weapons[0]||!weapons[1]||!mapChoice){alert("Wybierz bronie i mapƒô!");return}
  document.getElementById("startPanel").style.display="none";gameRunning=true;projectiles=[];
  let respawn1={x:canvas.width/2-100,y:canvas.height-120};
  let respawn2={x:canvas.width/2+100,y:canvas.height-120};
  players=[
    {x:respawn1.x,y:respawn1.y,vx:0,vy:0,hp:weaponHP(weapons[0]),weapon:weapons[0],dir:1,lastShot:0,lastHit:0,onGround:false},
    {x:respawn2.x,y:respawn2.y,vx:0,vy:0,hp:weaponHP(weapons[1]),weapon:weapons[1],dir:-1,lastShot:0,lastHit:0,onGround:false}
  ];loop();
}

// mapa
function drawMap(){
  ctx.fillStyle="#333";ctx.fillRect(0,canvas.height-40,canvas.width,40);
  if(mapChoice==="3"){ctx.fillRect(0,0,20,canvas.height);ctx.fillRect(canvas.width-20,0,20,canvas.height);
    ctx.fillRect(0,0,canvas.width,20);ctx.fillRect(canvas.width/3,canvas.height/2,canvas.width/3,20);}
  if(mapChoice==="2"){ctx.clearRect(0,canvas.height-40,canvas.width,40);
    ctx.fillStyle="#463";ctx.fillRect(canvas.width/2-200,canvas.height-80,400,40);
    ctx.fillRect(100,canvas.height-200,120,20);ctx.fillRect(canvas.width-220,canvas.height-200,120,20);}
}

// pƒôtla gry
function loop(){
  if(!gameRunning)return;
  ctx.clearRect(0,0,canvas.width,canvas.height);drawMap();
  players.forEach((p,i)=>{
    if(controls[`p${i+1}-left`]){p.vx=-4;p.dir=-1}else if(controls[`p${i+1}-right`]){p.vx=4;p.dir=1}else p.vx=0;
    p.vy+=0.6;p.x+=p.vx;p.y+=p.vy;p.onGround=false;

    if(mapChoice==="2"){if(p.y>canvas.height){p.hp=0}
      if(p.y>canvas.height-80&&p.y<canvas.height-60&&p.x>canvas.width/2-200&&p.x<canvas.width/2+200){p.y=canvas.height-80;p.vy=0;p.onGround=true}
      if(p.y>canvas.height-200&&p.y<canvas.height-180&&p.x>100&&p.x<220){p.y=canvas.height-200;p.vy=0;p.onGround=true}
      if(p.y>canvas.height-200&&p.y<canvas.height-180&&p.x>canvas.width-220&&p.x<canvas.width-100){p.y=canvas.height-200;p.vy=0;p.onGround=true}
    }else if(mapChoice==="3"){if(p.y>canvas.height-40){p.y=canvas.height-40;p.vy=0;p.onGround=true}
      if(p.y>canvas.height/2-20&&p.y<canvas.height/2&&p.x>canvas.width/3&&p.x<2*canvas.width/3){p.y=canvas.height/2-20;p.vy=0;p.onGround=true}
      if(p.x<30)p.x=30;if(p.x>canvas.width-30)p.x=canvas.width-30;
    }else{if(p.y>canvas.height-40){p.y=canvas.height-40;p.vy=0;p.onGround=true}
      if(p.x<20)p.x=20;if(p.x>canvas.width-20)p.x=canvas.width-20;}

    if(controls[`p${i+1}-up`] && p.onGround){p.vy=-20;p.onGround=false}
    ctx.font="28px Arial";ctx.fillText(i===0?"üòÄ":"üòé",p.x,p.y);

    if(p.weapon==="sword"){ctx.fillText("üó°Ô∏è",p.x+20*p.dir,p.y);
      players.forEach((op,j)=>{if(i!==j){if(Math.abs(p.x+20*p.dir-op.x)<25&&Math.abs(p.y-op.y)<20){
        if(Date.now()-p.lastHit>1600){op.hp-=2;p.lastHit=Date.now();}}}});}
    if(p.weapon==="bow"){if(Date.now()-p.lastShot>2000){projectiles.push({x:p.x,y:p.y,vx:p.dir*6,owner:i});p.lastShot=Date.now()}
      ctx.fillText("üèπ",p.x+20*p.dir,p.y);}
    if(p.weapon==="flail"&&(controls[`p${i+1}-left`]||controls[`p${i+1}-right`])){
      let angle=Date.now()/200+i*3,fx=p.x+Math.cos(angle)*70,fy=p.y+Math.sin(angle)*70;
      ctx.fillText("‚ö™",fx,fy);
      players.forEach((op,j)=>{if(i!==j){if(Math.abs(op.x-fx)<20&&Math.abs(op.y-fy)<20){
        if(Date.now()-p.lastHit>1600){op.hp-=1;p.lastHit=Date.now();}}}});}
  });

  ctx.fillStyle="yellow";projectiles.forEach((pr,idx)=>{pr.x+=pr.vx;ctx.fillRect(pr.x,pr.y,10,4);
    players.forEach((p,j)=>{if(j!==pr.owner&&Math.abs(p.x-pr.x)<20&&Math.abs(p.y-pr.y)<20){p.hp-=1;projectiles.splice(idx,1)}});});

  document.getElementById("hp1").innerText=players[0].hp;
  document.getElementById("hp2").innerText=players[1].hp;
  players.forEach((p,i)=>{if(p.hp<=0){alert("Wygra≈Ç gracz "+(i===0?2:1));resetGame()}});
  requestAnimationFrame(loop);
}

function resetGame(){gameRunning=false;document.getElementById("startPanel").style.display="flex";weapons=[null,null];mapChoice=null;
  document.querySelectorAll(".card").forEach(c=>c.classList.remove("selected"));}
</script>
</body>
</html>
